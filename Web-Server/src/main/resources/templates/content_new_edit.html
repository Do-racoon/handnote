<!DOCTYPE HTML>
<!--
	Editorial by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <title>HandNote</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css">
    <link rel="stylesheet" href="/css/main.css" />
    <style type="text/css">
    #editText{
        position: block;
    }

    #imageUpload{
        position: block;
        text-align: center;
    }

    #btn-convert{
        position: absolute;
<!--        top: 40%;-->
<!--        left:55%;-->
    }

    #btn-save{
        background-color:mediumseagreen;
    }

    .convertButton2{
        position: absolute;
<!--        top: 50%;-->
<!--        left: 55%;-->
    }

    #editContent{
        padding : 10px 20px 10px 20px;
    }

    .filebox {
        margin-bottom: 5px;
        top: 30%;
        left:55%;
    }

    .filebox input[type="file"] {
        position: absolute;
        width: 0;
        height: 0;
        padding: 0;
        overflow: hidden;
        border: 0;
    }

    .filebox label {
        display: inline-block;
        padding: 6px 10px;
        vertical-align: middle;
        background-color: #fdfdfd;
        cursor: pointer;
        border: 1px solid #ebebeb;
        border-radius: 5px;
        margin-bottom: 0px;
    }

    /* named upload */
    .filebox .upload-name {
        display: inline-block;
        color: #999;
        height: 35px;
        font-size:0.9em;
        padding: 0 10px;
        vertical-align: middle;
        background-color: #f5f5f5;
        border: 1px solid #ebebeb;
        border-radius: 5px;
    }
    input[type=file] {
            display: none;
    }

    .my_button {
        display: inline-block;
        width: 90px;
        text-align: center;
        padding: 10px;
        background-color: #006BCC;
        color: #fff;
        text-decoration: none;
        border-radius: 3px;
        position: absolute;
<!--        top: 30%;-->
<!--        left:55.4%;-->
    }



    .imgs_wrap {
        overflow:auto;
        border: 2px solid #A8A8A8;
        margin-top: 30px;
        margin-bottom: 30px;
        padding-top: 10px;
        padding-bottom: 10px;
        width: 200px;
        height: 500px;
    }
    .imgs_wrap img {
        max-width: 150px;
        margin-left: 10px;
        margin-right: 10px;
    }

    .container{
        display: grid;
        grid-template-columns: 250px 500px 200px 450px;
    }

    .container_sub{
        display: grid;
        grid-template-rows: 100px 80px 80px 80px;
    }

    </style>
</head>
<body class="is-preload">

<!-- Wrapper -->
<div id="wrapper">

    <!-- Main -->
    <div id="main">
        <div class="inner">

            <!-- Header -->
            <header id="header">
                <a href="/dashboard" class="logo"><strong>Editorial</strong> by HandNote</a>
            </header>

            <!-- Banner -->
            <section id="banner" style="padding-top:20px;">
                <!--									이부분-->
                <div class="content container" id="editContent">
                    <div id="imageUpload" class="item">
                        <div>
                            <div class="imgs_wrap">
                                <img id="img" />
                            </div>
                        </div>
                    </div>
                    <div id="imageContainer" class="item"></div>
                    <div class="item">
                        <div class="container_sub">
                            <div class="item">
                            </div>
                            <div class="filebox item">
                                <form id="form-convert" method="post" enctype="multipart/form-data">
                                    <a href="javascript:" onclick="fileUploadAction();" class="my_button">파일<br>업로드</a>
                                    <input id="convert" type="file" name="convert" multiple />
                                </form>
                            </div>
                            <div class="item">
                                <button id="btn-convert" type="button" style="background-color:#f56a6a; margin:0;">텍스트로<br>변환</button>
                            </div>
                            <div class="item">
                                <form action="http://localhost/upload.php" method="post" enctype="multipart/form-data">
                                    <button class="convertButton2" style="background-color:#f56a6a; margin:0;">중요부분<br>변환</button>
                                </form>
                            </div>
                        </div>
                    </div>

                    <div id="editText" class="item">
                        <input type="text" name="name" id="inputTitle" class="form-control" required="" style="width: 400px"/>
                        <div id="text" contenteditable="true" onclick="mouseUp(event)">
                        </div>
                        <form action="/dashboard" method="get">
                            <button id="btn-save" type="button">저장</button>
                            <button id="btn-back" type="submit">Home</button>
                        </form>
                    </div>

                </div>
            </section>


        </div>
    </div>

</div>
<!--			편집 메뉴-->
<ul id="editMenu">
    <li><div>글꼴선택</div>
        <ul id="fontName" class="dropdown-values">
            <li value="Courier New"><div>Courier New</div></li>
            <li value="Verdana"><div>Verdana</div></li>
            <li value="Times"><div>Times</div></li>
            <li value="Courier"><div>Courier</div></li>
            <li value="Copperplate"><div>Copperplate</div></li>
        </ul>
    </li>
    <li><div>글자크기</div>
        <ul id="fontSize" class="dropdown-values">
            <li value="1"><div>4px</div></li>
            <li value="2"><div>8px</div></li>
            <li value="3"><div>10px</div></li>
            <li value="4"><div>12px</div></li>
            <li value="5"><div>16px</div></li>
            <li value="6"><div>20px</div></li>
            <li value="7"><div>30px</div></li>
        </ul>
    </li>
    <li><div>글자색깔</div>
        <ul id="foreColor" class="dropdown-values">
            <li value="#f00"><div>빨강</div></li>
            <li value="#00f"><div>파랑</div></li>
            <li value="#0f0"><div>초록</div></li>
            <li value="#ffff00"><div>노랑</div></li>
            <li value="#000"><div>검정</div></li>
        </ul>
    </li>
    <li><div>글자배경색</div>
        <ul id="hiliteColor" class="dropdown-values">
            <li value="#f00"><div>빨강</div></li>
            <li value="#00f"><div>파랑</div></li>
            <li value="#0f0"><div>초록</div></li>
            <li value="#ffff00"><div>노랑</div></li>
            <li value="#000"><div>검정</div></li>
        </ul>
    </li>
    <li><div id="bold" class="btn-change-text">굵게</div></li>
    <li><div id="italic" class="btn-change-text">기울임</div></li>
    <li><div id="underLine" class="btn-change-text">밑</div></li>
</ul>
<!-- Scripts -->
<script src="/js/jquery.min.js"></script>
<script src="/js/browser.min.js"></script>
<script src="/js/breakpoints.min.js"></script>
<script src="/js/util.js"></script>
<script src="/js/main.js"></script>
<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
<script th:inline="javascript">
    $("#editMenu").menu();

     // 이미지 정보들을 담을 배열
    var sel_files = [];
    var prev_index = null;
    var sel_index = 0;
    var textList = [];
    var titleList = [];

    document.execCommand('styleWithCSS', false, true);
    document.execCommand('insertBrOnReturn', false, true);

    $(document).ready(function() {
        $("#text").focus();

        $("li").click(function(){
            let contentId = $(this).parent().attr('id');

            if(contentId == 'fontName' || contentId == 'fontSize'
                || contentId == 'foreColor' || contentId == 'hiliteColor'){
                console.log($(this).attr('value'));
               document.execCommand(contentId, false, $(this).attr('value'));
            }
        })

        $('.btn-change-text').click(function(){
            console.log(typeof($(this).attr('id')));
            document.execCommand($(this).attr('id'));
        });

        $('select').change(function(){
            document.execCommand($(this).attr('id'), false, $(this).val());
        });

        var fileTarget = $('#convert');
          fileTarget.on('change', function(){ // 값이 변경되면
              var cur=$(".filebox input[type='file']").val();
            $(".upload-name").val(cur);
        });

        $('#convert').on("change", handleImgFileSelect);
    });

    function fileUploadAction(){
        $("#convert").trigger('click');
    }
    function handleImgFileSelect(e) {
            // 이미지 정보들을 초기화
            sel_files = [];
            $(".imgs_wrap").empty();

            var files = e.target.files;
            var filesArr = Array.prototype.slice.call(files);

            var index = 0;
            filesArr.forEach(function(f) {
                if(!f.type.match("image.*")) {
                    alert("확장자는 이미지 확장자만 가능합니다.");
                    return;
                }

                sel_files.push(f);

                var reader = new FileReader();

                //onclick=\"deleteImageAction("+index+")\"

                reader.onload = function(e) {

                    var html = "<a href=\"javascript:void(0);\" onclick=\"setThumbnail("+index+")\" id=\"img_id_"+index+"\"><img src=\"" + e.target.result + "\" id=\"Img_id_"+index+"\" data-file='"+f.name+"' class='selProductFile' title='Click to Select'></a>";
                    $(".imgs_wrap").append(html);
                    index++;

                }
                reader.readAsDataURL(f);

            });
    }
    function deleteImageAction(index) {
        console.log("index : "+index);
        console.log("sel length : "+sel_files.length);

        sel_files.splice(index, 1);

        // 그 전의 썸네일 테두리를 제거
        prev_index = null;

        var img_id = "#img_id_"+index;
        $(img_id).remove();
    }
    // 이미지 미리보기
    function setThumbnail(index) {
        // 전의 선택된 썸네일이 존재할 경우
        if(prev_index != null){
            let prev_obj = document.getElementById("Img_id_"+prev_index);
            prev_obj.style.border = "";
        }
        $("#imageContainer > img").remove();

        var obj = document.getElementById("Img_id_"+index)
        obj.style.border = "3px solid green";

        // 현재 선택된 썸네일 번호 저장
        prev_index = index;
        sel_index = index;

        var src = obj.src

        // text 넣기
        $("#text").html(textList[index]);
        $("#inputTitle").val(titleList[index]);

        // 썸네일의 정보를 대입 / 출력
        var img = document.createElement("img");
        img.setAttribute("src", src);
        img.setAttribute("width", "400px");
        img.setAttribute("height", "500px");

        document.querySelector("#imageContainer").appendChild(img);
    }


    // 드래그 한 뒤 메뉴 생기게 하기
    function mouseUp(event){
        if (document.getSelection){
            // 마지막 드래그 위치 가져오기
            let el = document.getElementById("editMenu");

            // 메뉴
            if(document.getSelection().toString() == ''){
                el.style.display = "none";
            } else{
                let left = event.pageX;
                let top = event.pageY;

                el.style.left = left + "px";
                el.style.top = top + "px";
                el.style.display = "block";
                el.style.position = "absolute";
            }
        }
    }
</script>
<script src="./js/app/index.js"></script>
</body>
</html>